<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joureli - Journal, Calendar & Planning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --accent: #ec4899;
            --accent-light: #f472b6;
            --bg-dark: #f8fafc;
            --bg-card: #ffffff;
            --bg-lighter: #f1f5f9;
            --border: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e8edf4 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 0;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
            padding: 30px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(236, 72, 153, 0.04));
            border-radius: 16px;
            border: 1px solid rgba(99, 102, 241, 0.12);
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -2px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 0;
            font-weight: 400;
        }

        /* View Toggle */
        .view-toggle {
            display: none;
            gap: 12px;
            justify-content: center;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .toggle-btn {
            padding: 10px 24px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            background: rgba(255, 255, 255, 0.7);
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .toggle-btn:hover {
            border-color: var(--primary-light);
            background: rgba(248, 250, 252, 0.9);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
            transform: translateY(-1px);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(129, 140, 248, 0.25);
        }

        /* Main Layout */
        .layout {
            display: grid;
            grid-template-columns: 600px 340px;
            gap: 18px;
            margin-bottom: 40px;
        }

        /* Middle Section */
        .middle-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(5px);
            max-height: 100vh;
            overflow-y: auto;
        }

        .management-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .mgmt-tab {
            flex: 1;
            min-width: 100px;
            padding: 8px 12px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            background: rgba(248, 250, 252, 0.8);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .mgmt-tab:hover {
            border-color: var(--primary-light);
            background: rgba(248, 250, 252, 0.95);
        }

        .mgmt-tab.active {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            border-color: transparent;
        }

        .management-content {
            margin-bottom: 16px;
        }

        .mgmt-pane {
            display: none;
        }

        .mgmt-pane.active {
            display: block;
        }

        .mgmt-pane h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 0.95rem;
            font-weight: 700;
        }

        .mgmt-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .mgmt-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .mgmt-pane input {
            font-size: 0.85rem;
        }

        .family-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .family-member {
            background: rgba(99, 102, 241, 0.06);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: rgba(99, 102, 241, 0.06);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-light);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .events-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .event-item {
            background: rgba(99, 102, 241, 0.06);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--accent-light);
            font-size: 0.85rem;
        }

        .event-item-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .event-item-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }

        .team-card {
            background: rgba(99, 102, 241, 0.08);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.15);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-card button {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
        }

        .projects-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
        }

        .project-card {
            background: rgba(236, 72, 153, 0.08);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            border: 1px solid rgba(236, 72, 153, 0.15);
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .project-card button {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
        }

        .middle-section h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 0.95rem;
            font-weight: 700;
        }

        /* Calendar Wrapper */
        .calendar-wrapper {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px 8px 12px 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(99, 102, 241, 0.1);
            display: none;
            animation: fadeIn 0.4s ease-out;
            backdrop-filter: blur(5px);
        }

        .calendar-wrapper.active {
            display: block;
        }

        /* Timeline Wrapper */
        .timeline-wrapper {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(99, 102, 241, 0.1);
            display: none !important;
            animation: fadeIn 0.4s ease-out;
            backdrop-filter: blur(5px);
        }

        .timeline-wrapper.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Calendar Header */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 12px;
            flex-wrap: wrap;
        }

        .calendar-header h2 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 150px;
            text-align: center;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .nav-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(64, 86, 161, 0.25);
        }

        .nav-btn:active {
            transform: translateY(0);
        }

        .today-btn {
            background: var(--primary-light);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding: 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--primary-light) 0%, var(--accent-light) 50%, var(--success) 100%);
            border-radius: 10px;
        }

        .timeline-day-group {
            margin-bottom: 28px;
        }

        .timeline-day-header {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-left: 80px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            opacity: 0.7;
        }

        .timeline-event {
            margin-bottom: 18px;
            padding-left: 80px;
            position: relative;
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-event:nth-child(1) {
            animation-delay: 0.05s;
        }

        .timeline-event:nth-child(2) {
            animation-delay: 0.1s;
        }

        .timeline-event:nth-child(3) {
            animation-delay: 0.15s;
        }

        .timeline-event:nth-child(4) {
            animation-delay: 0.2s;
        }

        .timeline-event:nth-child(5) {
            animation-delay: 0.25s;
        }

        .timeline-dot {
            position: absolute;
            left: 18px;
            top: 10px;
            width: 24px;
            height: 24px;
            background: #fff;
            border: 3px solid;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.6rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2;
        }

        .timeline-event:hover .timeline-dot {
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(64, 86, 161, 0.3);
        }

        .timeline-event-card {
            background: rgba(255, 255, 255, 0.7);
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
            overflow: hidden;
        }

        .timeline-event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
        }

        .timeline-event-card:hover {
            transform: translateX(4px) translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .timeline-event-time {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .timeline-event-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .timeline-event-category {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 12px;
            background: var(--bg-lighter);
            color: var(--text-secondary);
        }

        .timeline-event-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .timeline-event-actions {
            display: flex;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .timeline-event-btn {
            background: var(--bg-lighter);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 6px 14px;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .timeline-event-btn:hover {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* Weekdays */
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 6px;
        }

        .weekday {
            text-align: center;
            font-weight: 700;
            color: var(--primary-light);
            padding: 8px 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.4px;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day {
            aspect-ratio: 1;
            background: rgba(248, 250, 252, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 6px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            min-height: 30px;
            font-size: 0.55rem;
        }

        .day:hover {
            background: rgba(241, 245, 249, 0.9);
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.12);
            transform: translateY(-2px);
        }

        .day.other-month {
            background: rgba(241, 245, 249, 0.4);
            color: var(--text-muted);
            opacity: 0.4;
        }

        .day.today {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(129, 140, 248, 0.25);
        }

        .day-number {
            font-weight: 700;
            font-size: 0.6rem;
            color: inherit;
            margin-bottom: 2px;
        }

        .day-events {
            flex: 1;
            overflow: hidden;
            font-size: 0.55rem;
            min-height: 0;
        }

        .event-badge {
            background: var(--bg-lighter);
            color: var(--text-secondary);
            padding: 1px 3px;
            border-radius: 2px;
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.45rem;
            height: 12px;
            line-height: 10px;
            display: block;
        }

        .today .event-badge {
            background: rgba(255, 255, 255, 0.3);
            color: #fff;
        }

        .event-badge:hover {
            background: var(--primary-light);
            color: #fff;
        }

        .event-count {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 1px;
            font-weight: 600;
        }

        .journal-count {
            position: absolute;
            top: 3px;
            right: 3px;
            background: rgba(139, 92, 246, 0.8);
            color: #fff;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 4;
        }

        .journal-count:hover {
            background: rgba(139, 92, 246, 1);
            transform: scale(1.1);
        }

        .today .journal-count {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Multi-day event styles */
        .multi-day-event {
            position: absolute;
            bottom: 5px;
            left: 5px;
            right: 5px;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3;
            background: linear-gradient(90deg, var(--event-color, var(--primary-light)), rgba(64, 86, 161, 0.65));
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .multi-day-event:hover {
            transform: scaleY(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .day.multi-day-event-start {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .day.multi-day-event-middle {
            border-radius: 0;
        }

        .day.multi-day-event-end {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* Sidebar */
        .sidebar {
            display: none !important;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(5px);
        }

        .sidebar-card h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 0.95rem;
            font-weight: 700;
            background: linear-gradient(135deg, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Sidebar Tabs */
        .sidebar-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 2px solid var(--border);
            background: #fff;
            border-radius: 10px;
            padding: 10px 12px 0;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border);
        }

        .sidebar-tab {
            padding: 8px 12px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-weight: 700;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -10px;
            padding-bottom: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.8rem;
        }

        .sidebar-tab:hover {
            color: var(--text-primary);
        }

        .sidebar-tab.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }

        .sidebar-content {
            display: none;
        }

        .sidebar-content.active {
            display: block;
        }

        /* Journal Entry - Day One Aesthetic */
        .journal-entry {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .journal-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.12);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .journal-entry-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            gap: 12px;
        }

        .journal-entry-date {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        .journal-entry-mood {
            font-size: 1.5rem;
            min-width: 24px;
        }

        .journal-entry-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 12px;
            word-wrap: break-word;
        }

        .journal-entry-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .journal-entry-stats {
            display: flex;
            gap: 16px;
        }

        .journal-entry-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .journal-entry-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .journal-entry-tag {
            background: rgba(129, 140, 248, 0.15);
            color: var(--primary-light);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            border: 1px solid rgba(129, 140, 248, 0.3);
        }

        .journal-entry-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            padding-top: 10px;
            border-top: 1px solid rgba(99, 102, 241, 0.1);
        }

        .journal-entry-btn {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: var(--primary-light);
            cursor: pointer;
            font-size: 0.75rem;
            padding: 6px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 700;
        }

        .journal-entry-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
            color: #fff;
        }

        .journal-day-header {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1rem;
            margin: 24px 0 16px 0;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            letter-spacing: 0.3px;
        }

        .journal-day-events {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .journal-day-event {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        .journal-day-event:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .journal-day-event-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .journal-day-event-text {
            color: var(--text-primary);
            flex: 1;
            font-weight: 600;
        }

        .journal-no-entries {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Journals Container - Main Section */
        #pastEntries {
            display: grid;
            gap: 28px;
        }

        .journal-entries-header {
            margin-bottom: 40px;
        }

        .journal-entries-header h2 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        /* Mood Selector */
        .mood-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .mood-btn {
            font-size: 1.8rem;
            background: var(--bg-lighter);
            border: 2px solid var(--border);
            border-radius: 50%;
            width: 52px;
            height: 52px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mood-btn:hover {
            transform: scale(1.08);
            border-color: var(--primary-light);
        }

        .mood-btn.selected {
            border-color: var(--primary-light);
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            box-shadow: 0 4px 12px rgba(64, 86, 161, 0.3);
        }

        /* Tags Input */
        .tags-input-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            padding: 10px;
            background: var(--bg-lighter);
            border: 1px solid var(--border);
            border-radius: 10px;
            min-height: 44px;
            align-items: center;
        }

        .tag-badge {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tag-badge-remove {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.85;
            transition: opacity 0.2s ease;
        }

        .tag-badge-remove:hover {
            opacity: 1;
        }

        .tags-input {
            flex: 1;
            min-width: 100px;
            border: none;
            background: transparent;
            outline: none;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .tags-input::placeholder {
            color: var(--text-muted);
        }

        /* Event Form */
        .event-form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 11px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: inherit;
            color: var(--text-primary);
            transition: all 0.2s ease;
            background: #fff;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(64, 86, 161, 0.1);
        }

        .form-group input::placeholder {
            color: var(--text-muted);
        }

        .add-event-btn {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: var(--bg-dark);
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 800;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 8px;
            box-shadow: 0 8px 24px rgba(129, 140, 248, 0.3);
            font-size: 0.95rem;
        }

        .add-event-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(129, 140, 248, 0.4);
        }

        .add-event-btn:active {
            transform: translateY(-2px);
        }

        /* Upcoming Events */
        .upcoming-events {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-item {
            background: rgba(99, 102, 241, 0.1);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 14px;
            border-left: 4px solid var(--primary-light);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .event-item:hover {
            background: rgba(99, 102, 241, 0.15);
            transform: translateX(6px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2);
        }

        .event-item-title {
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .event-item-date {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .event-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .event-item-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .event-item-btn:hover {
            background: var(--primary-light);
            color: #fff;
            border-color: var(--primary-light);
        }

        .empty-message {
            text-align: center;
            color: var(--text-muted);
            padding: 24px 0;
            font-style: italic;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
            overflow-y: auto;
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 28px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.3s ease-out;
            margin: auto;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 16px;
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: var(--primary-light);
            transform: scale(1.1);
        }

        .modal-body {
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 22px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            box-shadow: 0 4px 12px rgba(64, 86, 161, 0.2);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(64, 86, 161, 0.3);
        }

        .modal-btn-danger {
            background: var(--danger);
            color: #fff;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }

        .modal-btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        .modal-btn-secondary {
            background: var(--bg-lighter);
            color: var(--primary-light);
            border: 1px solid var(--border);
        }

        .modal-btn-secondary:hover {
            background: var(--border);
            border-color: var(--primary-light);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .layout {
                grid-template-columns: 1fr;
                gap: 28px;
            }

            .sidebar {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px;
            }

            .calendar-header h2 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .header {
                margin-bottom: 24px;
                padding: 16px 0;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .view-toggle {
                margin-bottom: 24px;
            }

            .calendar-wrapper,
            .timeline-wrapper {
                padding: 20px;
            }

            .calendar-header {
                flex-direction: column;
                gap: 16px;
                margin-bottom: 24px;
            }

            .calendar-header h2 {
                font-size: 1.4rem;
            }

            .calendar-nav {
                width: 100%;
                gap: 8px;
            }

            .nav-btn {
                flex: 1;
            }

            .sidebar {
                grid-template-columns: 1fr;
            }

            .day {
                min-height: 100px;
                padding: 8px;
            }

            .day-number {
                font-size: 0.9rem;
            }

            .event-badge {
                font-size: 0.65rem;
                padding: 2px 5px;
            }

            .weekday {
                font-size: 0.75rem;
                padding: 10px 4px;
            }

            .timeline::before {
                left: 20px;
            }

            .timeline-dot {
                left: 7px;
                width: 26px;
                height: 26px;
                font-size: 0.65rem;
            }

            .timeline-event {
                padding-left: 60px;
                margin-bottom: 24px;
            }

            .timeline-day-header {
                padding-left: 60px;
                font-size: 0.85rem;
                margin-bottom: 18px;
            }

            .timeline-event-card {
                padding: 16px;
            }

            .timeline-event-title {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .toggle-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }

            .calendar-wrapper,
            .timeline-wrapper {
                padding: 16px;
            }

            .sidebar {
                gap: 20px;
            }

            .sidebar-card {
                padding: 16px;
            }

            .day {
                aspect-ratio: auto;
                min-height: 80px;
            }

            .calendar-grid {
                gap: 8px;
            }

            .timeline-event {
                padding-left: 50px;
            }

            .timeline::before {
                left: 15px;
            }

            .timeline-dot {
                left: 2px;
                width: 24px;
                height: 24px;
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Journal Writing Modal - Focus Mode */
        .journal-write-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        .journal-write-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .journal-write-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            width: 95vw;
            max-width: 1000px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.4s ease-out;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .journal-write-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 28px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(236, 72, 153, 0.02));
            border-radius: 24px 24px 0 0;
        }

        .journal-write-title {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .journal-write-date {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .journal-write-mood-selector {
            display: flex;
            gap: 10px;
        }

        .journal-write-mood-btn {
            font-size: 1.5rem;
            background: var(--bg-lighter);
            border: 2px solid var(--border);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .journal-write-mood-btn:hover {
            transform: scale(1.1);
            border-color: var(--primary-light);
        }

        .journal-write-mood-btn.selected {
            border-color: var(--primary-light);
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            box-shadow: 0 4px 12px rgba(64, 86, 161, 0.3);
        }

        .journal-write-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .journal-write-close:hover {
            color: var(--primary);
            transform: scale(1.1);
        }

        .journal-write-toolbar {
            display: flex;
            gap: 12px;
            padding: 16px 36px;
            background: rgba(99, 102, 241, 0.08);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-section {
            display: flex;
            gap: 8px;
            align-items: center;
            border-right: 1px solid rgba(99, 102, 241, 0.2);
            padding-right: 12px;
        }

        .toolbar-section:last-child {
            border-right: none;
        }

        .toolbar-btn {
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--primary-light);
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar-btn:hover {
            background: var(--primary-light);
            color: var(--bg-dark);
            border-color: var(--primary-light);
        }

        .toolbar-btn.active {
            background: var(--primary-light);
            color: var(--bg-dark);
        }

        .toolbar-separator {
            width: 1px;
            height: 22px;
            background: rgba(99, 102, 241, 0.2);
            margin: 0 8px;
        }

        .journal-write-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .journal-editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 32px;
            overflow-y: auto;
        }

        #journalWriteText {
            flex: 1;
            border: none;
            outline: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 1.05rem;
            line-height: 1.8;
            color: var(--text-secondary);
            resize: none;
            caret-color: var(--primary-light);
            background: transparent;
        }

        #journalWriteText::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .journal-editor-preview {
            flex: 1;
            padding: 36px;
            overflow-y: auto;
            background: rgba(99, 102, 241, 0.08);
            border-left: 1px solid rgba(99, 102, 241, 0.2);
        }

        .journal-write-preview {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
        }

        .journal-write-preview h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 1.5em 0 0.5em 0;
        }

        .journal-write-preview h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 1.3em 0 0.4em 0;
        }

        .journal-write-preview h3 {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 1.1em 0 0.3em 0;
        }

        .journal-write-preview ul,
        .journal-write-preview ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        .journal-write-preview li {
            margin: 0.3em 0;
        }

        .journal-write-preview img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1em 0;
        }

        .journal-write-preview blockquote {
            border-left: 4px solid var(--primary-light);
            padding-left: 1em;
            margin: 1em 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        .journal-image-insert {
            display: none;
        }

        .journal-image-preview {
            max-width: 100%;
            max-height: 300px;
            margin: 12px 0;
            border-radius: 8px;
        }

        .journal-write-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 36px;
            background: rgba(99, 102, 241, 0.08);
            border-top: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 0 0 24px 24px;
        }

        .journal-write-stats {
            display: flex;
            gap: 24px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .journal-write-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }

        .journal-write-actions {
            display: flex;
            gap: 14px;
        }

        .journal-write-save {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: var(--bg-dark);
            border: none;
            padding: 12px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 800;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(129, 140, 248, 0.3);
            font-size: 0.95rem;
        }

        .journal-write-save:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(129, 140, 248, 0.4);
        }

        .journal-write-cancel {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary-light);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 12px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .journal-write-cancel:hover {
            background: rgba(99, 102, 241, 0.25);
            border-color: var(--primary-light);
        }

        .journal-auto-save {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .journal-auto-save.saved {
            color: var(--success);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Daily Planner Sidebar */
        .daily-planner-sidebar {
            display: flex;
            position: fixed;
            right: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            border-left: 1px solid rgba(99, 102, 241, 0.1);
            box-shadow: -4px 0 16px rgba(0, 0, 0, 0.06);
            flex-direction: column;
            z-index: 900;
            backdrop-filter: blur(5px);
        }

        .daily-planner-sidebar.active {
            display: flex;
        }

        .daily-planner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(236, 72, 153, 0.02));
        }

        .daily-planner-header h3 {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            background: linear-gradient(135deg, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .daily-planner-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .daily-planner-close:hover {
            color: var(--text-primary);
        }

        .daily-planner-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            padding: 0;
        }

        .daily-planner-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-weight: 700;
            cursor: pointer;
            font-size: 0.75rem;
            text-align: center;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .daily-planner-tab.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }

        .daily-planner-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .daily-planner-pane {
            display: none;
        }

        .daily-planner-pane.active {
            display: block;
        }

        .planner-date-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
        }

        .planner-date-nav button {
            background: none;
            border: none;
            color: var(--primary-light);
            cursor: pointer;
            font-weight: 700;
            padding: 4px 8px;
        }

        .planner-date-display {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
        }

        .planner-section {
            margin-bottom: 16px;
        }

        .planner-section-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .planner-event-item {
            background: rgba(99, 102, 241, 0.08);
            border-left: 3px solid var(--primary-light);
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .planner-event-item:hover {
            background: rgba(99, 102, 241, 0.15);
        }

        .planner-event-time {
            font-weight: 700;
            color: var(--primary-light);
            font-size: 0.65rem;
        }

        .planner-event-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-top: 2px;
        }

        .planner-todo-item {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            padding: 8px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.75rem;
        }

        .planner-todo-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-top: 1px;
            flex-shrink: 0;
        }

        .planner-todo-text {
            flex: 1;
            color: var(--text-primary);
        }

        .planner-todo-item input:checked+.planner-todo-text {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .planner-input {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 6px;
            background: #fff;
            color: var(--text-primary);
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        .planner-btn {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-light));
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .planner-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(129, 140, 248, 0.2);
        }

        .planner-empty {
            text-align: center;
            padding: 20px 8px;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        body {
            padding-right: 0;
        }

        body.planner-open {
            padding-right: 320px;
        }

        /* Markdown rendering styles */
        #modalBody h1, #modalBody h2, #modalBody h3 {
            margin: 16px 0 8px 0;
            font-weight: 700;
            color: var(--text-primary);
        }

        #modalBody h1 {
            font-size: 1.5rem;
            border-bottom: 2px solid rgba(99, 102, 241, 0.2);
            padding-bottom: 8px;
        }

        #modalBody h2 {
            font-size: 1.25rem;
        }

        #modalBody h3 {
            font-size: 1.1rem;
        }

        #modalBody p {
            margin: 8px 0;
        }

        #modalBody strong {
            font-weight: 700;
            color: var(--primary-light);
        }

        #modalBody em {
            font-style: italic;
            color: var(--text-secondary);
        }

        #modalBody u {
            text-decoration: underline;
        }

        #modalBody code {
            background: rgba(99, 102, 241, 0.08);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--primary-light);
        }

        #modalBody pre {
            background: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 8px 0;
            border-left: 3px solid var(--primary-light);
        }

        #modalBody pre code {
            background: none;
            padding: 0;
            color: var(--text-primary);
        }

        #modalBody ul, #modalBody ol {
            margin: 8px 0 8px 24px;
        }

        #modalBody li {
            margin: 4px 0;
        }

        #modalBody blockquote {
            border-left: 3px solid var(--primary-light);
            padding-left: 12px;
            margin: 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        #modalBody a {
            color: var(--primary-light);
            text-decoration: none;
            border-bottom: 1px solid rgba(129, 140, 248, 0.3);
            transition: all 0.2s ease;
        }

        #modalBody a:hover {
            border-bottom-color: var(--primary-light);
            color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1> Joureli</h1>
            <p>Journal, plan, and organize your life</p>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="toggle-btn active" onclick="switchView('calendar')"> Calendar Mode</button>
            <button class="toggle-btn" onclick="switchView('timeline')"> Timeline Mode</button>
            <button class="toggle-btn" onclick="toggleDailyPlanner()"> Daily Planner</button>
        </div>

        <!-- Main Layout -->
        <div class="layout">
            <!-- Calendar View -->
            <div class="calendar-wrapper active">
                <div class="calendar-header">
                    <button class="nav-btn" onclick="previousMonth()"> Previous</button>
                    <h2 id="monthYear"></h2>
                    <button class="nav-btn today-btn" onclick="goToToday()">Today</button>
                    <button class="nav-btn" onclick="nextMonth()">Next </button>
                </div>

                <div class="weekdays">
                    <div class="weekday">Sun</div>
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                    <div class="weekday">Sat</div>
                </div>

                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <!-- Middle Management Section -->
            <div class="middle-section">
                <!-- Management Selector -->
                <div class="management-selector">
                    <button class="mgmt-tab active" onclick="switchMgmtView('family')"> Family</button>
                    <button class="mgmt-tab" onclick="switchMgmtView('journal')"> Journal</button>
               </div>

                <!-- Management Content -->
                <div class="management-content">
                    <!-- Family View -->
                    <div class="mgmt-pane active" id="familyPane">
                        <h3>Family Calendar</h3>
                        <div class="family-list" id="familyList">
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">No family members added yet.</p>
                        </div>
                        <input type="text" placeholder="Add family member..." id="familyInput" style="width: 100%; padding: 8px; margin-top: 12px; border: 1px solid var(--border); border-radius: 6px;">
                        <button class="mgmt-btn" onclick="addFamilyMember()" style="width: 100%; margin-top: 8px;">+ Add Member</button>
                    </div>

                    <!-- Journal View -->
                    <div class="mgmt-pane" id="journalPane2">
                        <h3>Journal Stats</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalEntries">0</div>
                                <div class="stat-label">Total Entries</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="thisMonth">0</div>
                                <div class="stat-label">This Month</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="currentStreak">0</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                        </div>
                        <div id="journalRecentList" style="margin-top: 16px;"></div>
                    </div>

                    <!-- Events View -->
                    <div class="mgmt-pane" id="eventsPane2">
                        <h3>Upcoming Events</h3>
                        <div id="upcomingEventsList" class="events-list"></div>
                    </div>
                </div>

                <!-- Teams Section -->
                <div class="teams-section" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <h3> Teams</h3>
                    <div class="teams-grid" id="teamsList">
                        <p style="color: var(--text-secondary); font-size: 0.9rem; grid-column: 1/-1;">No teams yet. Create your first team!</p>
                    </div>
                    <input type="text" placeholder="Team name..." id="teamInput" style="width: 100%; padding: 8px; margin-top: 12px; border: 1px solid var(--border); border-radius: 6px;">
                    <button class="mgmt-btn" onclick="addTeam()" style="width: 100%; margin-top: 8px;">+ Add Team</button>
                </div>

                <!-- Projects Section -->
                <div class="projects-section" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <h3> In Progress Projects</h3>
                    <div class="projects-list" id="projectsList">
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">No projects in progress.</p>
                    </div>
                    <input type="text" placeholder="Project name..." id="projectInput" style="width: 100%; padding: 8px; margin-top: 12px; border: 1px solid var(--border); border-radius: 6px;">
                    <button class="mgmt-btn" onclick="addProject()" style="width: 100%; margin-top: 8px;">+ Add Project</button>
                </div>
            </div>

            <!-- Timeline View -->
            <div class="timeline-wrapper">
                <div class="calendar-header">
                    <h2> Event Timeline</h2>
                </div>
                <div class="timeline" id="timelineContainer"></div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar Tabs -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" onclick="switchSidebarTab('events')"> Events</button>
                    <button class="sidebar-tab" onclick="switchSidebarTab('journal')"> Journal</button>
                </div>

                <!-- Events Tab -->
                <div class="sidebar-content active" id="eventsTab">
                    <!-- Add Event Card -->
                    <div class="sidebar-card">
                        <h3> New Event</h3>
                        <form class="event-form" onsubmit="addEvent(event)">
                            <div class="form-group">
                                <label>Event Title</label>
                                <input type="text" id="eventTitle" placeholder="e.g., Team Meeting" required>
                            </div>

                            <div class="form-group">
                                <label>Start Date</label>
                                <input type="date" id="eventDate" required>
                            </div>

                            <div class="form-group">
                                <label>End Date (Optional)</label>
                                <input type="date" id="eventEndDate">
                            </div>

                            <div class="form-group">
                                <label>Start Time</label>
                                <input type="time" id="eventStartTime">
                            </div>

                            <div class="form-group">
                                <label>End Time</label>
                                <input type="time" id="eventEndTime">
                            </div>

                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="eventDesc" placeholder="Add details..."
                                    style="resize: none; height: 60px;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Category</label>
                                <select id="eventCategory">
                                    <option value="work">Work</option>
                                    <option value="personal">Personal</option>
                                    <option value="health">Health</option>
                                    <option value="social">Social</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Recurring</label>
                                <select id="eventRecurring">
                                    <option value="none">No Repeat</option>
                                    <option value="weekly">Every Week</option>
                                    <option value="monthly">Every Month</option>
                                    <option value="yearly">Every Year</option>
                                </select>
                            </div>

                            <button type="submit" class="add-event-btn">+ Add Event</button>
                        </form>
                    </div>

                    <!-- Upcoming Events -->
                    <div class="sidebar-card">
                        <h3> Upcoming Events</h3>
                        <div class="upcoming-events" id="upcomingEvents">
                            <div class="empty-message">No upcoming events</div>
                        </div>
                    </div>
                </div>

                <!-- Journal Tab -->
                <div class="sidebar-content" id="journalTab">
                    <!-- Journal Entry Card -->
                    <div class="sidebar-card">
                        <h3> New Journal Entry</h3>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label>Date</label>
                            <input type="date" id="journalDate" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label>Tags (press Enter to add)</label>
                            <div class="tags-input-container" id="tagsContainer">
                                <input type="text" class="tags-input" id="tagsInput"
                                    placeholder="e.g., work, health, travel...">
                            </div>
                            <input type="hidden" id="journalTags">
                        </div>
                        <button type="button" class="add-event-btn" onclick="openJournalWriteModal()"> Start
                            Writing</button>
                    </div>

                    <!-- Day Review Card -->
                     <div class="sidebar-card">
                         <h3> Journal Day Review</h3>
                         <div class="planner-date-nav" style="margin-bottom: 12px;">
                             <button onclick="previousJournalDay()"></button>
                             <div class="planner-date-display" id="journalDayDisplay">Today</div>
                             <button onclick="nextJournalDay()"></button>
                         </div>
                         <div id="dayReview">
                             <div class="empty-message">Select a date to review</div>
                         </div>
                     </div>

                    <!-- Past Entries Card -->
                    <div class="sidebar-card">
                        <h3> Past Entries</h3>
                        <div id="pastEntries">
                            <div class="empty-message">No entries yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Planner Sidebar -->
    <div class="daily-planner-sidebar" id="dailyPlannerSidebar">
        <div class="daily-planner-header">
            <h3> Daily Planner</h3>
            <!-- <button class="daily-planner-close" onclick="toggleDailyPlanner()"></button> -->
        </div>

        <div class="daily-planner-tabs">
            <button class="daily-planner-tab active" onclick="switchPlannerTab('journal')">Journal</button>
            <button class="daily-planner-tab" onclick="switchPlannerTab('today')">Today</button>
            <button class="daily-planner-tab" onclick="switchPlannerTab('schedule')">Schedule</button>
            <button class="daily-planner-tab" onclick="switchPlannerTab('todos')">Todos</button>
        </div>

        <div class="daily-planner-content">
            <!-- Journal Pane -->
            <div class="daily-planner-pane active" id="journalPane">
                <!-- New Journal Entry -->
                <div class="planner-section">
                    <button class="planner-btn" style="width: 100%; margin-bottom: 12px;" onclick="openJournalWriteModal()"> New Entry</button>
                </div>

                <!-- New Event -->
                <div class="planner-section" style="padding: 12px; background: rgba(99, 102, 241, 0.05); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.1);">
                    <div class="planner-section-title"> New Event</div>
                    <input type="text" class="planner-input" id="journalPaneEventTitle" placeholder="Event Title" style="margin-bottom: 6px;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Start Date</label>
                    <input type="date" class="planner-input" id="journalPaneEventDate" style="margin-bottom: 6px;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">End Date</label>
                    <input type="date" class="planner-input" id="journalPaneEventEndDate" style="margin-bottom: 6px;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Start Time</label>
                    <input type="time" class="planner-input" id="journalPaneEventStartTime" style="margin-bottom: 6px;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">End Time</label>
                    <input type="time" class="planner-input" id="journalPaneEventEndTime" style="margin-bottom: 6px;">
                    <textarea class="planner-input" id="journalPaneEventDesc" placeholder="Description..." style="resize: none; height: 40px; margin-bottom: 6px;"></textarea>
                    <select class="planner-input" id="journalPaneEventCategory" style="margin-bottom: 6px;">
                        <option value="work">Work</option>
                        <option value="personal">Personal</option>
                        <option value="health">Health</option>
                        <option value="social">Social</option>
                        <option value="other">Other</option>
                    </select>
                    <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Recurring</label>
                    <select class="planner-input" id="journalPaneEventRecurring" style="margin-bottom: 6px;">
                        <option value="none">No Repeat</option>
                        <option value="weekly">Every Week</option>
                        <option value="monthly">Every Month</option>
                        <option value="yearly">Every Year</option>
                    </select>
                    <button class="planner-btn" style="width: 100%;" onclick="addEventFromPlanner()">+ Add Event</button>
                </div>

                <!-- Day's Journal Entries -->
                <div class="planner-section" style="margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(99, 102, 241, 0.1);">
                    <div class="planner-section-title" id="plannerDayTitle"> Today</div>
                    <div id="plannerDayJournalEntries" class="planner-empty">No entries for this day</div>
                </div>

                <!-- Timeline Toggle -->
                <div class="planner-section" style="margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(99, 102, 241, 0.1);">
                    <!-- Timeline button removed as requested -->
                </div>
            </div>

            <!-- Today Pane -->
            <div class="daily-planner-pane" id="todayPane">
                <div class="planner-date-nav">
                    <button onclick="previousDay()"></button>
                    <div class="planner-date-display" id="todayDateDisplay">Today</div>
                    <button onclick="nextDay()"></button>
                </div>
                <div class="planner-section">
                    <div class="planner-section-title"> Upcoming Events</div>
                    <div id="todayUpcomingEvents" class="planner-empty">No events today</div>
                </div>
                <div class="planner-section">
                    <div class="planner-section-title"> Today's Todos</div>
                    <div id="todayTodos"></div>
                </div>
            </div>

            <!-- Schedule Pane -->
            <div class="daily-planner-pane" id="schedulePane">
                <div class="planner-date-nav">
                    <button onclick="previousDay()"></button>
                    <div class="planner-date-display" id="scheduleDateDisplay">Today</div>
                    <button onclick="nextDay()"></button>
                </div>
                <div class="planner-section">
                    <div class="planner-section-title">+ Add Event</div>
                    <input type="text" class="planner-input" id="scheduleEventTitle" placeholder="Event name..." style="margin-bottom: 6px;">
                    <label style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Start Date</label>
                    <input type="date" class="planner-input" id="scheduleEventDate" style="margin-bottom: 6px;">
                    <label style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">End Date</label>
                    <input type="date" class="planner-input" id="scheduleEventEndDate" style="margin-bottom: 6px;">
                    <label style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Start Time</label>
                    <input type="time" class="planner-input" id="scheduleEventStartTime" style="margin-bottom: 6px;">
                    <label style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">End Time</label>
                     <input type="time" class="planner-input" id="scheduleEventEndTime" style="margin-bottom: 6px;">
                     <label style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: block; margin-bottom: 2px;">Recurring</label>
                     <select class="planner-input" id="scheduleEventRecurring" style="margin-bottom: 6px;">
                         <option value="none">No Repeat</option>
                         <option value="weekly">Every Week</option>
                         <option value="monthly">Every Month</option>
                         <option value="yearly">Every Year</option>
                     </select>
                     <button class="planner-btn" onclick="addScheduleEvent()">Add Event</button>
                </div>
                <div class="planner-section">
                    <div class="planner-section-title"> Day Schedule</div>
                    <div id="scheduleDayEvents" class="planner-empty">No events scheduled</div>
                </div>
            </div>

            <!-- Todos Pane -->
            <div class="daily-planner-pane" id="todosPane">
                <div class="planner-section">
                    <div class="planner-section-title">+ Add Todo</div>
                    <input type="text" class="planner-input" id="todoInput" placeholder="What to do...">
                    <button class="planner-btn" onclick="addTodo()">Add Todo</button>
                </div>
                <div class="planner-section">
                    <div class="planner-section-title"> All Todos</div>
                    <div id="allTodos" class="planner-empty">No todos yet</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Journal Writing Modal - Focus Mode -->
    <div class="journal-write-modal" id="journalWriteModal">
        <div class="journal-write-container">
            <!-- Header -->
            <div class="journal-write-header">
                <div class="journal-write-title">
                    <div class="journal-write-date" id="writeDate">Today</div>
                    <div style="font-size: 1.3rem; font-weight: 600; color: #2b3a67;"> Your Thoughts</div>
                </div>
                <div class="journal-write-mood-selector" id="writeModalMoodSelector">
                    <button type="button" class="journal-write-mood-btn" data-mood="" title="Great"></button>
                    <button type="button" class="journal-write-mood-btn" data-mood="" title="Good"></button>
                    <button type="button" class="journal-write-mood-btn" data-mood="" title="Okay"></button>
                    <button type="button" class="journal-write-mood-btn" data-mood="" title="Sad"></button>
                    <button type="button" class="journal-write-mood-btn" data-mood="" title="Frustrated"></button>
                </div>
                <button class="journal-write-close" onclick="closeJournalWriteModal()"></button>
            </div>

            <!-- Toolbar -->
            <div class="journal-write-toolbar">
                <div class="toolbar-section">
                    <button type="button" class="toolbar-btn" title="Bold (Ctrl+B)"
                        onclick="insertMarkdown('**', '**')">
                        <span style="font-weight: bold;">B</span>
                    </button>
                    <button type="button" class="toolbar-btn" title="Italic (Ctrl+I)"
                        onclick="insertMarkdown('_', '_')">
                        <span style="font-style: italic;">I</span>
                    </button>
                    <button type="button" class="toolbar-btn" title="Underline" onclick="insertMarkdown('<u>', '</u>')">
                        <span style="text-decoration: underline;">U</span>
                    </button>
                </div>

                <div class="toolbar-section">
                    <button type="button" class="toolbar-btn" title="Heading 1"
                        onclick="insertMarkdown('# ', '')">H1</button>
                    <button type="button" class="toolbar-btn" title="Heading 2"
                        onclick="insertMarkdown('## ', '')">H2</button>
                    <button type="button" class="toolbar-btn" title="Heading 3"
                        onclick="insertMarkdown('### ', '')">H3</button>
                </div>

                <div class="toolbar-section">
                    <button type="button" class="toolbar-btn" title="Bullet List" onclick="insertMarkdown(' ', '')">
                        List</button>
                    <button type="button" class="toolbar-btn" title="Numbered List"
                        onclick="insertMarkdown('1. ', '')">1. List</button>
                    <button type="button" class="toolbar-btn" title="Quote"
                        onclick="insertMarkdown('> ', '')">Quote</button>
                </div>

                <div class="toolbar-section">
                    <button type="button" class="toolbar-btn" title="Insert Link" onclick="insertLink()">
                        Link</button>
                    <button type="button" class="toolbar-btn"
                        onclick="document.getElementById('journalImageInsert').click()">
                         Image
                    </button>
                    <input type="file" id="journalImageInsert" class="journal-image-insert" accept="image/*"
                        onchange="insertImage(event)">
                </div>

                <div class="toolbar-section">
                    <button type="button" class="toolbar-btn" id="previewToggle" onclick="togglePreview()">
                        Preview</button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="journal-write-content">
                <div class="journal-editor-area">
                    <textarea id="journalWriteText"
                        placeholder="Write freely. Express yourself. No judgment, no limits..."></textarea>
                </div>
                <div class="journal-editor-preview" id="previewArea" style="display: none;">
                    <div class="journal-write-preview" id="previewContent"></div>
                </div>
            </div>

            <!-- Footer -->
            <div class="journal-write-footer">
                <div class="journal-write-stats">
                    <div class="journal-write-stat">
                        <span></span>
                        <span id="writeWordCount">0 words</span>
                    </div>
                    <div class="journal-write-stat">
                        <span></span>
                        <span id="writeCharCount">0 characters</span>
                    </div>
                    <div class="journal-auto-save" id="autoSaveIndicator">
                        <span></span>
                        <span>Saving...</span>
                    </div>
                </div>

                <div class="journal-write-actions">
                    <button class="journal-write-cancel" onclick="closeJournalWriteModal()">Discard</button>
                    <button class="journal-write-save" onclick="saveFromWriteModal()">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details/Edit Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Event Details</h2>
                <button class="close-btn" onclick="closeModal()"></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-danger" onclick="deleteEvent()">Delete</button>
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let events = JSON.parse(localStorage.getItem('joureviEvents')) || [];
        let journals = JSON.parse(localStorage.getItem('joureviJournals')) || [];
        let selectedEventId = null;
        let isEditMode = false;
        let currentView = 'calendar';
        let currentSidebarTab = 'events';
        let currentMood = null;
        let currentTags = [];
        let editingJournalId = null;
        let editingEventId = null;
        let journalDraft = JSON.parse(localStorage.getItem('joureviDraft')) || null;

        const COLORS = {
            work: '#4056a1',
            personal: '#8b5cf6',
            health: '#10b981',
            social: '#f59e0b',
            other: '#6b7280'
        };

        function initializeCalendar() {
            const today = new Date();
            // Set date fields using local date string to avoid timezone issues
            const localDateStr = today.toISOString().slice(0, 10);
            document.getElementById('eventDate').value = localDateStr;
            document.getElementById('journalDate').value = localDateStr;
            renderCalendar();
            renderTimeline();
            renderUpcomingEvents();
            renderDayReview(today);
            renderPastEntries();
            renderPlannerJournal();
            setupMoodSelector();
            setupTagsInput();
            // Activate daily planner by default
            document.getElementById('dailyPlannerSidebar').classList.add('active');
        }

        function setupMoodSelector() {
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentMood = btn.getAttribute('data-mood');
                    document.getElementById('journalMood').value = currentMood;
                });
            });
        }

        function setupTagsInput() {
            const input = document.getElementById('tagsInput');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const tag = input.value.trim().toLowerCase();
                    if (tag && !currentTags.includes(tag)) {
                        currentTags.push(tag);
                        renderTags();
                        input.value = '';
                        updateTagsField();
                    }
                }
            });
        }

        function renderTags() {
            const container = document.getElementById('tagsContainer');
            const input = container.querySelector('.tags-input');
            container.innerHTML = '';
            currentTags.forEach(tag => {
                const badge = document.createElement('div');
                badge.className = 'tag-badge';
                badge.innerHTML = `${tag} <span class="tag-badge-remove" onclick="removeTag('${tag}')"></span>`;
                container.appendChild(badge);
            });
            container.appendChild(input);
        }

        function removeTag(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            renderTags();
            updateTagsField();
        }

        function updateTagsField() {
            document.getElementById('journalTags').value = JSON.stringify(currentTags);
        }

        function switchSidebarTab(tab) {
            currentSidebarTab = tab;
            document.querySelectorAll('.sidebar-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sidebar-content').forEach(el => el.classList.remove('active'));

            if (tab === 'events') {
                document.querySelector('.sidebar-tab:nth-child(1)').classList.add('active');
                document.getElementById('eventsTab').classList.add('active');
            } else {
                document.querySelector('.sidebar-tab:nth-child(2)').classList.add('active');
                document.getElementById('journalTab').classList.add('active');
                // Initialize journal review when switching to journal tab
                journalReviewDate = new Date();
                updateJournalDayReview();
            }
        }

        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.calendar-wrapper, .timeline-wrapper').forEach(el => el.classList.remove('active'));

            if (view === 'calendar') {
                document.querySelector('.toggle-btn:first-child').classList.add('active');
                document.querySelector('.calendar-wrapper').classList.add('active');
                renderCalendar();
            } else {
                document.querySelector('.toggle-btn:last-child').classList.add('active');
                document.querySelector('.timeline-wrapper').classList.add('active');
                renderTimeline();
            }
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            document.getElementById('monthYear').textContent = currentDate.toLocaleDateString('en-US', {
                month: 'long',
                year: 'numeric'
            });

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            let currentDateTemp = new Date(startDate);
            const dayElements = [];

            for (let i = 0; i < 42; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';

                if (currentDateTemp.getMonth() !== month) {
                    dayEl.classList.add('other-month');
                }

                const today = new Date();
                if (currentDateTemp.getFullYear() === today.getFullYear() &&
                    currentDateTemp.getMonth() === today.getMonth() &&
                    currentDateTemp.getDate() === today.getDate()) {
                    dayEl.classList.add('today');
                }

                const dayDate = new Date(currentDateTemp);
                const dayNumber = currentDateTemp.getDate();
                const dateStr = dateToString(currentDateTemp);

                // Find events on this day (single-day and multi-day)
                const dayEvents = events.filter(e => {
                    const eventStart = new Date(e.date);
                    const eventEnd = new Date(e.endDate || e.date);
                    const currentDay = new Date(dateStr);
                    return currentDay >= eventStart && currentDay <= eventEnd;
                });

                // Find journals on this day
                const dayJournals = journals.filter(j => j.date === dateStr);

                // Separate single-day and multi-day events
                const singleDayEvents = dayEvents.filter(e => e.date === dateStr && (!e.endDate || e.endDate === e.date));
                const multiDayEvents = dayEvents.filter(e => e.endDate && e.endDate !== e.date);

                dayEl.innerHTML = `
					<div class="day-number">${dayNumber}</div>
					<div class="day-events">
						${singleDayEvents.slice(0, 2).map(e => `
							<div class="event-badge" style="background-color: ${COLORS[e.category]}; color: #fff;" onclick="viewEvent('${e.id}', event)">
								${e.title}
							</div>
						`).join('')}
						${singleDayEvents.length > 2 ? `<div class="event-count">+${singleDayEvents.length - 2} more</div>` : ''}
					</div>
				`;

                // Add journal count badge
                if (dayJournals.length > 0) {
                    const journalBadge = document.createElement('div');
                    journalBadge.className = 'journal-count';
                    journalBadge.textContent = dayJournals.length;
                    journalBadge.onclick = (evt) => { evt.stopPropagation(); viewDayJournals(dateStr); };
                    dayEl.appendChild(journalBadge);
                }

                // Add multi-day event bars
                multiDayEvents.forEach(e => {
                    const eventStart = new Date(e.date);
                    const eventEnd = new Date(e.endDate);
                    const isStart = dateStr === e.date;
                    const isEnd = dateStr === e.endDate;

                    const bar = document.createElement('div');
                    bar.className = 'multi-day-event';
                    if (isStart) bar.className += ' multi-day-event-start';
                    if (isEnd) bar.className += ' multi-day-event-end';
                    if (!isStart && !isEnd) bar.className += ' multi-day-event-middle';

                    bar.style.setProperty('--event-color', COLORS[e.category]);
                    bar.textContent = `${isStart ? ' ' : ''}${e.title}${isEnd ? ' ' : ''}`;
                    bar.onclick = (evt) => { evt.stopPropagation(); viewEvent(e.id); };
                    dayEl.appendChild(bar);
                });

                dayEl.addEventListener('click', () => selectDate(dayDate));
                dayElements.push({ el: dayEl, dateStr });
                grid.appendChild(dayEl);

                currentDateTemp.setDate(currentDateTemp.getDate() + 1);
            }
        }

        function renderTimeline() {
            const sortedEvents = [...events]
                .sort((a, b) => {
                    const dateA = new Date(a.date + ' ' + a.time);
                    const dateB = new Date(b.date + ' ' + b.time);
                    return dateA - dateB;
                });

            const container = document.getElementById('timelineContainer');

            if (sortedEvents.length === 0) {
                container.innerHTML = '<div class="empty-message">No events scheduled</div>';
                return;
            }

            // Group events by day
            const groupedByDay = {};
            sortedEvents.forEach(e => {
                if (!groupedByDay[e.date]) {
                    groupedByDay[e.date] = [];
                }
                groupedByDay[e.date].push(e);
            });

            // Create timeline with day groups
            let html = '';
            Object.keys(groupedByDay).forEach(date => {
                const dayEvents = groupedByDay[date];
                const dateObj = new Date(date);
                const dateStr = dateObj.toLocaleDateString('en-US', {
                    weekday: 'long',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });

                html += `<div class="timeline-day-group"><div class="timeline-day-header"> ${dateStr}</div>`;

                dayEvents.forEach((e, idx) => {
                    html += `
						<div class="timeline-event">
							<div class="timeline-dot" style="border-color: ${COLORS[e.category]}; background: ${COLORS[e.category]};"></div>
							<div class="timeline-event-card" style="--border-color: ${COLORS[e.category]};">
								<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
									<div>
										${e.time !== '00:00' ? `<div class="timeline-event-time"> ${e.time}</div>` : '<div class="timeline-event-time"> All Day</div>'}
										<div class="timeline-event-title">${e.title}</div>
									</div>
									<div class="timeline-event-category" style="background: ${COLORS[e.category]}; color: #fff;">${e.category}</div>
								</div>
								${e.description ? `<div class="timeline-event-desc">${e.description}</div>` : ''}
								<div class="timeline-event-actions">
									<button class="timeline-event-btn" onclick="viewEvent('${e.id}', event)">View</button>
									<button class="timeline-event-btn" onclick="editEvent('${e.id}', event)">Edit</button>
									<button class="timeline-event-btn" onclick="deleteEventById('${e.id}')">Delete</button>
								</div>
							</div>
						</div>
					`;
                });

                html += `</div>`;
            });

            container.innerHTML = html;

            // Apply border color to cards
            document.querySelectorAll('.timeline-event-card').forEach(card => {
                const borderColor = card.style.getPropertyValue('--border-color');
                if (borderColor) {
                    card.style.borderLeftColor = borderColor;
                }
                const bar = card.querySelector('.timeline-event-card::before');
                if (borderColor) {
                    card.style.setProperty('--border-left', borderColor);
                }
            });
        }

        function selectDate(date) {
            const dateStr = dateToString(date);
            document.getElementById('eventDate').value = dateStr;
            document.getElementById('journalDate').value = dateStr;
            document.getElementById('eventTitle').focus();
            renderDayReview(date);
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }

        function dateToString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function addEvent(e) {
             e.preventDefault();

             const title = document.getElementById('eventTitle').value;
             const date = document.getElementById('eventDate').value;
             const endDate = document.getElementById('eventEndDate').value;
             const startTime = document.getElementById('eventStartTime').value;
             const endTime = document.getElementById('eventEndTime').value;
             const desc = document.getElementById('eventDesc').value;
             const category = document.getElementById('eventCategory').value;
             const recurring = document.getElementById('eventRecurring').value;

             if (!title || !date) return;

             // Validate date range
             if (endDate && new Date(endDate) < new Date(date)) {
                 alert('End date must be after or equal to start date');
                 return;
             }

             if (editingEventId) {
                 // Update existing event
                 const eventIndex = events.findIndex(ev => ev.id === editingEventId);
                 if (eventIndex !== -1) {
                     events[eventIndex].title = title;
                     events[eventIndex].date = date;
                     events[eventIndex].endDate = endDate || date;
                     events[eventIndex].startTime = startTime || '00:00';
                     events[eventIndex].endTime = endTime || '00:00';
                     events[eventIndex].description = desc;
                     events[eventIndex].category = category;
                     events[eventIndex].recurring = recurring;
                     events[eventIndex].updatedAt = new Date().toISOString();
                 }
                 editingEventId = null;
             } else {
                 // Add new event
                 const event = {
                     id: Date.now().toString(),
                     title,
                     date,
                     endDate: endDate || date,
                     startTime: startTime || '00:00',
                     endTime: endTime || '00:00',
                     description: desc,
                     category,
                     recurring,
                     createdAt: new Date().toISOString()
                 };
                 events.push(event);
             }

            saveEvents();
            renderCalendar();
            renderTimeline();
            renderUpcomingEvents();

            // Reset form
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventStartTime').value = '';
            document.getElementById('eventEndTime').value = '';
            document.getElementById('eventDesc').value = '';
            document.getElementById('eventEndDate').value = '';

            const today = new Date();
            document.getElementById('eventDate').value = dateToString(today);
        }

        function renderUpcomingEvents() {
            const upcoming = events
                .filter(e => new Date(e.date) >= new Date(new Date().toISOString().split('T')[0]))
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 10);

            const container = document.getElementById('upcomingEvents');

            if (upcoming.length === 0) {
                container.innerHTML = '<div class="empty-message">No upcoming events</div>';
                return;
            }

            container.innerHTML = upcoming.map(e => `
				<div class="event-item" style="border-left-color: ${COLORS[e.category]}">
					<div class="event-item-title">${e.title}</div>
					<div class="event-item-date">
						${new Date(e.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
						${e.time !== '00:00' ? ` at ${e.time}` : ''}
					</div>
					<div class="event-item-actions">
						<button class="event-item-btn" onclick="viewEvent('${e.id}')">Details</button>
						<button class="event-item-btn" onclick="editEvent('${e.id}')">Edit</button>
					</div>
				</div>
			`).join('');
        }

        function markdownToHtml(markdown) {
            let html = markdown;
            
            // Images - before other patterns
            html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; margin: 12px 0; border-radius: 6px;">');
            
            // Headers
            html = html.replace(/^### (.*?)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.*?)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.*?)$/gm, '<h1>$1</h1>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/_(.*?)_/g, '<em>$1</em>');
            
            // Underline
            html = html.replace(/<u>(.*?)<\/u>/g, '<u>$1</u>');
            
            // Code blocks
            html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            
            // Inline code
            html = html.replace(/`(.*?)`/g, '<code>$1</code>');
            
            // Lists
            html = html.replace(/^\* (.*?)$/gm, '<li>$1</li>');
            html = html.replace(/^ (.*?)$/gm, '<li>$1</li>');
            html = html.replace(/(\<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Numbered lists
            html = html.replace(/^(\d+)\. (.*?)$/gm, '<li>$2</li>');
            
            // Links
            html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            // Blockquotes
            html = html.replace(/^> (.*?)$/gm, '<blockquote>$1</blockquote>');
            
            // Line breaks
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p>' + html + '</p>';
            
            return html;
        }

        function viewDayJournals(dateStr) {
            const dayJournals = journals.filter(j => j.date === dateStr);
            
            if (dayJournals.length === 0) return;
            
            const date = new Date(dateStr);
            const dateDisplay = date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            let content = `<div style="color: #1e293b;">`;
            
            dayJournals.forEach((journal, index) => {
                const createdDate = new Date(journal.createdAt);
                const timeStr = createdDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                const renderedHtml = markdownToHtml(journal.text);
                
                content += `
                    <div style="margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid rgba(99, 102, 241, 0.1);">
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">
                            <span>${journal.mood}</span>
                            <span style="margin-left: 8px;">${timeStr}</span>
                            ${journal.tags && journal.tags.length > 0 ? `<div style="margin-top: 4px;">${journal.tags.map(tag => `<span style="display: inline-block; background: rgba(99, 102, 241, 0.1); color: var(--text-secondary); padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-right: 4px;">#${tag}</span>`).join('')}</div>` : ''}
                        </div>
                        <div style="font-size: 0.9rem; line-height: 1.6; color: var(--text-primary);">
                            ${renderedHtml}
                        </div>
                        <button style="margin-top: 8px; padding: 4px 8px; font-size: 0.75rem; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 4px; cursor: pointer;" onclick="editJournal('${journal.id}')">Edit</button>
                    </div>
                `;
            });
            
            content += `</div>`;
            
            const modal = document.getElementById('eventModal');
            document.getElementById('modalTitle').textContent = ` Journals - ${dateDisplay}`;
            document.getElementById('modalBody').innerHTML = content;
            modal.classList.add('active');
        }

        function editJournal(journalId) {
            closeModal();
            const journal = journals.find(j => j.id === journalId);
            if (!journal) return;
            
            editingJournalId = journalId;
            document.getElementById('journalDate').value = journal.date;
            document.getElementById('journalWriteText').value = journal.text;
            currentMood = journal.mood;
            currentTags = journal.tags || [];
            
            openJournalWriteModal();
        }

        function viewEvent(eventId, e) {
            if (e) e.stopPropagation();
            selectedEventId = eventId;
            isEditMode = false;
            const event = events.find(ev => ev.id === eventId);

            if (!event) return;

            const startDate = new Date(event.date);
            const endDate = new Date(event.endDate || event.date);
            const isMultiDay = event.endDate && event.endDate !== event.date;
            const daysSpan = isMultiDay ? Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1 : 1;

            const dateStr = startDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const endDateStr = isMultiDay ? endDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) : '';

            const modal = document.getElementById('eventModal');
            document.getElementById('modalTitle').textContent = event.title;
            const timeDisplay = (event.startTime && event.startTime !== '00:00') || (event.time && event.time !== '00:00') ? (event.startTime || event.time) : 'All day';
            document.getElementById('modalBody').innerHTML = `
				<div style="color: #4f5d75;">
					<p><strong>${isMultiDay ? 'Date Range:' : 'Date:'}</strong> ${dateStr}${isMultiDay ? `  ${endDateStr}` : ''}</p>
					${isMultiDay ? `<p><strong>Duration:</strong> ${daysSpan} day${daysSpan > 1 ? 's' : ''}</p>` : ''}
					<p><strong>Time:</strong> ${timeDisplay}</p>
					<p><strong>Category:</strong> <span style="display: inline-block; background: ${COLORS[event.category]}; color: #fff; padding: 2px 8px; border-radius: 4px; text-transform: capitalize;">${event.category}</span></p>
					${event.description ? `<p><strong>Description:</strong> ${event.description}</p>` : ''}
				</div>
			`;

            modal.classList.add('active');
        }

        function editEvent(eventId, e) {
            if (e) e.stopPropagation();
            editingEventId = eventId;
            const event = events.find(ev => ev.id === eventId);

            if (!event) return;

            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventDate').value = event.date;
            document.getElementById('eventEndDate').value = event.endDate || event.date;
            document.getElementById('eventStartTime').value = event.startTime || event.time || '';
            document.getElementById('eventEndTime').value = event.endTime || '';
            document.getElementById('eventDesc').value = event.description || '';
            document.getElementById('eventCategory').value = event.category;
            document.getElementById('eventTitle').focus();

            closeModal();
        }

        // Journal Write Modal Functions
        function openJournalWriteModal(entryId = null) {
             const date = new Date(document.getElementById('journalDate').value);
             const dateStr = date.toLocaleDateString('en-US', {
                 weekday: 'long',
                 month: 'long',
                 day: 'numeric'
             });

             document.getElementById('writeDate').textContent = dateStr;
             document.getElementById('previewContent').innerHTML = '';
             document.getElementById('previewArea').style.display = 'none';
             document.getElementById('previewToggle').classList.remove('active');

             // Only set editingJournalId if not already set by editJournal()
             if (!editingJournalId && entryId) {
                 editingJournalId = entryId;
             }

             // Only clear mood and tags if NOT editing (NOT if editingJournalId is already set)
             if (!editingJournalId) {
                 currentMood = null;
                 currentTags = [];
                 document.getElementById('journalWriteText').value = '';
             }

             renderTags();
             updateTagsField();

             // Setup mood selector in write modal
             document.querySelectorAll('.journal-write-mood-btn').forEach(btn => {
                 btn.classList.remove('selected');
                 btn.addEventListener('click', (e) => {
                     e.preventDefault();
                     document.querySelectorAll('.journal-write-mood-btn').forEach(b => b.classList.remove('selected'));
                     btn.classList.add('selected');
                     currentMood = btn.getAttribute('data-mood');
                     saveDraft();
                 });
             });

             // Set selected mood if any
             if (currentMood) {
                 const selectedBtn = document.querySelector(`.journal-write-mood-btn[data-mood="${currentMood}"]`);
                 if (selectedBtn) selectedBtn.classList.add('selected');
             }

             document.getElementById('journalWriteText').focus();
             setupWriteModalStats();

             document.getElementById('journalWriteModal').classList.add('active');
         }

        function closeJournalWriteModal() {
            saveDraft();
            document.getElementById('journalWriteModal').classList.remove('active');
            editingJournalId = null;
            currentMood = null;
        }

        function saveDraft() {
            const date = document.getElementById('journalDate').value;
            const text = document.getElementById('journalWriteText').value;

            if (text.trim()) {
                journalDraft = {
                    date,
                    text,
                    mood: currentMood,
                    tags: [...currentTags],
                    savedAt: new Date().toISOString()
                };
                localStorage.setItem('joureviDraft', JSON.stringify(journalDraft));
            } else {
                journalDraft = null;
                localStorage.removeItem('joureviDraft');
            }
        }

        function clearDraft() {
            journalDraft = null;
            localStorage.removeItem('joureviDraft');
        }

        function setupWriteModalStats() {
            const textarea = document.getElementById('journalWriteText');
            let draftTimeout;

            textarea.addEventListener('input', () => {
                const text = textarea.value;
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                const chars = text.length;

                document.getElementById('writeWordCount').textContent = words + ' word' + (words !== 1 ? 's' : '');
                document.getElementById('writeCharCount').textContent = chars + ' character' + (chars !== 1 ? 's' : '');

                // Update preview if visible
                if (document.getElementById('previewArea').style.display !== 'none') {
                    updatePreview();
                }

                // Auto-save draft after user stops typing
                clearTimeout(draftTimeout);
                draftTimeout = setTimeout(() => {
                    saveDraft();
                    showDraftSaved();
                }, 1500);
            });
        }

        function showDraftSaved() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('saved');
            indicator.innerHTML = '<span></span><span>Draft saved</span>';
            setTimeout(() => {
                if (indicator.classList.contains('saved')) {
                    indicator.classList.remove('saved');
                    indicator.innerHTML = '<span></span><span>Saving...</span>';
                }
            }, 2000);
        }

        function insertMarkdown(before, after) {
            const textarea = document.getElementById('journalWriteText');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            const beforeText = textarea.value.substring(0, start);
            const afterText = textarea.value.substring(end);

            const newText = beforeText + before + selectedText + after + afterText;
            textarea.value = newText;
            textarea.focus();
            textarea.selectionStart = start + before.length;
            textarea.selectionEnd = start + before.length + selectedText.length;

            // Trigger input event for stats update
            textarea.dispatchEvent(new Event('input'));
        }

        function insertLink() {
            const url = prompt('Enter URL:');
            if (!url) return;
            insertMarkdown('[', '](' + url + ')');
        }

        function insertImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const imgData = e.target.result;
                const textarea = document.getElementById('journalWriteText');
                const start = textarea.selectionStart;
                const before = textarea.value.substring(0, start);
                const after = textarea.value.substring(start);

                // Insert markdown image syntax with base64 data
                const altText = file.name.replace(/\.[^/.]+$/, "");
                textarea.value = before + `\n![${altText}](${imgData})\n` + after;
                textarea.focus();

                // Show in preview if visible
                if (document.getElementById('previewArea').style.display !== 'none') {
                    updatePreview();
                }

                textarea.dispatchEvent(new Event('input'));
            };
            reader.readAsDataURL(file);
        }

        function togglePreview() {
            const previewArea = document.getElementById('previewArea');
            const toggle = document.getElementById('previewToggle');

            if (previewArea.style.display === 'none') {
                previewArea.style.display = 'block';
                toggle.classList.add('active');
                updatePreview();
            } else {
                previewArea.style.display = 'none';
                toggle.classList.remove('active');
            }
        }

        function updatePreview() {
             const text = document.getElementById('journalWriteText').value;
             let html = previewMarkdownToHtml(text);
             document.getElementById('previewContent').innerHTML = html;
         }

        function previewMarkdownToHtml(markdown) {
             let html = markdown;

             // Images - before other patterns
             html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; margin: 12px 0; border-radius: 6px;">');

             // Headers
             html = html.replace(/^### (.*?)$/gm, '<h3>$1</h3>');
             html = html.replace(/^## (.*?)$/gm, '<h2>$1</h2>');
             html = html.replace(/^# (.*?)$/gm, '<h1>$1</h1>');

             // Bold
             html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

             // Italic
             html = html.replace(/_(.*?)_/g, '<em>$1</em>');

             // Blockquote
             html = html.replace(/^> (.*?)$/gm, '<blockquote>$1</blockquote>');

             // Lists
             html = html.replace(/^\ (.*?)$/gm, '<li>$1</li>');
             html = html.replace(/^\d+\. (.*?)$/gm, '<li>$1</li>');

             // Line breaks
             html = html.replace(/\n/g, '<br>');

             // Links
             html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');

             return html;
         }

        function saveFromWriteModal() {
            const date = document.getElementById('journalDate').value;
            const text = document.getElementById('journalWriteText').value;
            const mood = currentMood || '';
            const tags = [...currentTags];

            if (!date || !text.trim()) {
                alert('Please write something before saving.');
                return;
            }

            if (editingJournalId) {
                // Update existing entry
                const entryIndex = journals.findIndex(j => j.id === editingJournalId);
                if (entryIndex !== -1) {
                    journals[entryIndex].date = date;
                    journals[entryIndex].text = text;
                    journals[entryIndex].mood = mood;
                    journals[entryIndex].tags = tags;
                    journals[entryIndex].updatedAt = new Date().toISOString();
                }
            } else {
                // Create new entry
                const entry = {
                    id: Date.now().toString(),
                    date,
                    text,
                    mood,
                    tags,
                    createdAt: new Date().toISOString()
                };
                journals.push(entry);
            }

            saveJournals();
            clearDraft();

            // Reset
            closeJournalWriteModal();
            currentMood = null;
            currentTags = [];
            window.journalImages = [];
            editingJournalId = null;
            document.getElementById('tagsContainer').innerHTML = '<input type="text" class="tags-input" id="tagsInput" placeholder="e.g., work, health, travel...">';
            setupTagsInput();

            // Refresh views
            renderDayReview(new Date(date));
            renderPastEntries();
            renderPlannerJournal();
        }

        function previousJournalDay() {
            journalReviewDate.setDate(journalReviewDate.getDate() - 1);
            updateJournalDayReview();
        }

        function nextJournalDay() {
            journalReviewDate.setDate(journalReviewDate.getDate() + 1);
            updateJournalDayReview();
        }

        function updateJournalDayReview() {
            const dateDisplay = journalReviewDate.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            document.getElementById('journalDayDisplay').textContent = dateDisplay;
            renderDayReview(journalReviewDate);
        }

        function renderDayReview(date) {
            const dateStr = dateToString(date);
            const dayEvents = events.filter(e => {
                const eventStart = new Date(e.date);
                const eventEnd = new Date(e.endDate || e.date);
                const currentDay = new Date(dateStr);
                return currentDay >= eventStart && currentDay <= eventEnd;
            });

            const dayJournals = journals.filter(j => j.date === dateStr);

            const container = document.getElementById('dayReview');
            const dateDisplay = date.toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'short',
                day: 'numeric'
            });

            let html = `<div class="journal-day-header">${dateDisplay}</div>`;

            // Show events if any
            if (dayEvents.length > 0) {
                html += `<div style="margin-bottom: 12px;"><strong style="font-size: 0.85rem; color: var(--text-secondary);">Events</strong><div class="journal-day-events">`;
                dayEvents.forEach(e => {
                    html += `
                        <div class="journal-day-event">
                            <div class="journal-day-event-badge" style="background-color: ${COLORS[e.category]};"></div>
                            <div class="journal-day-event-text">
                                <strong>${e.title}</strong>
                                ${e.time !== '00:00' ? ` at ${e.time}` : ' (All day)'}
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }

            // Show journal entries if any
            if (dayJournals.length > 0) {
                html += `<div><strong style="font-size: 0.85rem; color: var(--text-secondary);">Journal Entries</strong>`;
                dayJournals.forEach(entry => {
                    const wordCount = entry.text.trim().split(/\s+/).length;
                    const readTime = Math.ceil(wordCount / 200);
                    const preview = entry.text.substring(0, 60) + (entry.text.length > 60 ? '...' : '');
                    html += `
                        <div style="background: rgba(99, 102, 241, 0.06); padding: 8px; border-radius: 6px; margin-top: 6px; font-size: 0.8rem; cursor: pointer;" onclick="viewJournalEntry('${entry.id}')">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 2px;">${entry.mood} ${readTime}m read</div>
                            <div style="color: var(--text-secondary);">${preview}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // If neither events nor journals
            if (dayEvents.length === 0 && dayJournals.length === 0) {
                html += `<div class="empty-message">No events or journal entries for this day</div>`;
            }

            container.innerHTML = html;
        }

        function renderPastEntries() {
            const sortedJournals = [...journals].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 8);
            const container = document.getElementById('pastEntries');

            if (sortedJournals.length === 0) {
                container.innerHTML = '<div class="journal-no-entries">No entries yet. Start your first entry above.</div>';
                return;
            }

            let html = '';
            let currentDateGroup = null;

            sortedJournals.forEach(entry => {
                const entryDate = new Date(entry.date);
                const dateParts = entryDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }).split(' ');
                const dayOfWeek = entryDate.toLocaleDateString('en-US', { weekday: 'short' });
                const dateStr = `${dayOfWeek}, ${dateParts[0]} ${dateParts[1]}`;

                // Add date header if changed
                if (currentDateGroup !== entry.date) {
                    if (currentDateGroup !== null) html += '</div>';
                    html += `<div class="journal-day-header">${dateStr}</div>`;
                    currentDateGroup = entry.date;
                }

                const wordCount = entry.text.trim().split(/\s+/).length;
                const readTime = Math.ceil(wordCount / 200); // avg 200 words per minute
                const preview = entry.text.substring(0, 90) + (entry.text.length > 90 ? '...' : '');

                html += `
					<div class="journal-entry">
						<div class="journal-entry-header">
							<div class="journal-entry-date">${dateStr}</div>
							<div class="journal-entry-mood">${entry.mood || ''}</div>
						</div>
						${entry.tags && entry.tags.length > 0 ? `
							<div class="journal-entry-tags">
								${entry.tags.map(tag => `<span class="journal-entry-tag">#${tag}</span>`).join('')}
							</div>
						` : ''}
						<div class="journal-entry-text">${preview}</div>
						<div class="journal-entry-meta">
							<div class="journal-entry-stats">
								<div class="journal-entry-stat">
									<span></span>
									<span>${wordCount} words</span>
								</div>
								<div class="journal-entry-stat">
									<span></span>
									<span>${readTime} min read</span>
								</div>
							</div>
						</div>
						<div class="journal-entry-actions">
							<button class="journal-entry-btn" onclick="viewJournalEntry('${entry.id}')">Read</button>
							<button class="journal-entry-btn" onclick="editJournalEntry('${entry.id}')">Edit</button>
							<button class="journal-entry-btn" onclick="deleteJournalEntry('${entry.id}')">Delete</button>
						</div>
					</div>
				`;
            });
            if (currentDateGroup !== null) html += '</div>';

            container.innerHTML = html;
        }

        function viewJournalEntry(entryId) {
            const entry = journals.find(j => j.id === entryId);
            if (!entry) return;

            const entryDate = new Date(entry.date);
            const dateStr = entryDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const wordCount = entry.text.trim().split(/\s+/).length;
            const readTime = Math.ceil(wordCount / 200);
            const charCount = entry.text.length;

            const modal = document.getElementById('eventModal');
            document.getElementById('modalTitle').textContent = entry.mood + ' Journal Entry';
            document.getElementById('modalBody').innerHTML = `
				<div style="color: #4f5d75;">
					<p style="font-size: 1.1rem; font-weight: 600; color: #2b3a67; margin-bottom: 12px;">${dateStr}</p>
					${entry.tags && entry.tags.length > 0 ? `
						<div style="margin-bottom: 16px; display: flex; gap: 6px; flex-wrap: wrap;">
							${entry.tags.map(tag => `<span style="background: #f0f3f7; color: #4056a1; padding: 4px 10px; border-radius: 16px; font-size: 0.85rem; font-weight: 500;">#${tag}</span>`).join('')}
						</div>
					` : ''}
					<div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 0.9rem;">
						<div><strong> Words:</strong> ${wordCount}</div>
						<div><strong> Read time:</strong> ${readTime} min</div>
						<div><strong> Characters:</strong> ${charCount}</div>
					</div>
					<p style="margin-top: 15px; white-space: pre-wrap; line-height: 1.8; font-size: 0.95rem; color: #3a3a3a;">${entry.text}</p>
				</div>
			`;

            const footer = document.querySelector('.modal-footer');
            footer.innerHTML = `
				<button class="modal-btn modal-btn-danger" onclick="deleteJournalEntry('${entry.id}')">Delete</button>
				<button class="modal-btn modal-btn-secondary" onclick="closeModal()">Close</button>
			`;

            modal.classList.add('active');
        }

        function editJournalEntry(entryId) {
            const entry = journals.find(j => j.id === entryId);
            if (!entry) return;

            document.getElementById('journalDate').value = entry.date;

            // Close any open modals first
            closeModal();
            switchSidebarTab('journal');

            // Open write modal with the entry ID for editing
            setTimeout(() => {
                openJournalWriteModal(entryId);
                document.getElementById('journalWriteText').focus();
            }, 100);
        }

        function deleteJournalEntry(entryId) {
            if (confirm('Are you sure you want to delete this entry?')) {
                journals = journals.filter(j => j.id !== entryId);
                saveJournals();
                renderPastEntries();
                renderPlannerJournal();
                closeModal();
            }
        }

        function saveJournals() {
            localStorage.setItem('joureviJournals', JSON.stringify(journals));
        }

        function closeModal() {
            document.getElementById('eventModal').classList.remove('active');
            selectedEventId = null;
        }

        function deleteEvent() {
            if (selectedEventId) {
                deleteEventById(selectedEventId);
            }
        }

        function deleteEventById(eventId) {
            events = events.filter(e => e.id !== eventId);
            saveEvents();
            renderCalendar();
            renderTimeline();
            renderUpcomingEvents();
            closeModal();
        }

        function saveEvents() {
            localStorage.setItem('joureviEvents', JSON.stringify(events));
        }

        // Close modal when clicking outside
        document.getElementById('eventModal').addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') {
                closeModal();
            }
        });

        // Daily Planner Functions
        let plannerCurrentDate = new Date();
        let journalReviewDate = new Date();
        let plannerTodos = JSON.parse(localStorage.getItem('joureviTodos')) || [];

        function toggleDailyPlanner() {
            const sidebar = document.getElementById('dailyPlannerSidebar');
            sidebar.classList.toggle('active');
            document.body.classList.toggle('planner-open');
            if (sidebar.classList.contains('active')) {
                renderPlannerToday();
            }
        }

        function switchPlannerTab(tab) {
            document.querySelectorAll('.daily-planner-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.daily-planner-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Pane').classList.add('active');
            document.querySelector(`[onclick="switchPlannerTab('${tab}')"]`).classList.add('active');

            if (tab === 'today') {
                renderPlannerToday();
            } else if (tab === 'schedule') {
                renderPlannerSchedule();
            } else if (tab === 'todos') {
                renderPlannerTodos();
            } else if (tab === 'journal') {
                renderPlannerJournal();
            }
        }

        function renderPlannerJournal() {
            const todayStr = dateToString(new Date());
            const dayEntries = journals.filter(j => j.date === todayStr);
            const container = document.getElementById('plannerDayJournalEntries');
            
            // Set the day title
            const dateDisplay = new Date(todayStr).toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('plannerDayTitle').textContent = ` ${dateDisplay}`;

            // Set the event date field
            document.getElementById('journalPaneEventDate').value = todayStr;

            if (dayEntries.length === 0) {
                container.innerHTML = '<div class="planner-empty">No entries for this day</div>';
                return;
            }

            let html = '';
            dayEntries.forEach(entry => {
                const preview = entry.text.substring(0, 50) + (entry.text.length > 50 ? '...' : '');
                
                html += `
                    <div style="background: rgba(99, 102, 241, 0.06); padding: 8px; border-radius: 6px; margin-bottom: 6px; cursor: pointer; font-size: 0.75rem;" onclick="viewJournalEntry('${entry.id}')">
                        <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 2px;">${entry.mood} Entry</div>
                        <div style="color: var(--text-secondary);">${preview}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function addEventFromPlanner() {
             const title = document.getElementById('journalPaneEventTitle').value.trim();
             const dateStr = document.getElementById('journalPaneEventDate').value;
             const endDateStr = document.getElementById('journalPaneEventEndDate').value;
             const startTime = document.getElementById('journalPaneEventStartTime').value;
             const endTime = document.getElementById('journalPaneEventEndTime').value;
             const description = document.getElementById('journalPaneEventDesc').value.trim();
             const category = document.getElementById('journalPaneEventCategory').value;
             const recurring = document.getElementById('journalPaneEventRecurring').value;

             if (!title || !dateStr) {
                 alert('Please enter event title and start date');
                 return;
             }

             if (endDateStr && new Date(endDateStr) < new Date(dateStr)) {
                 alert('End date must be after or equal to start date');
                 return;
             }

             const event = {
                 id: Date.now().toString(),
                 title,
                 date: dateStr,
                 endDate: endDateStr || dateStr,
                 startTime: startTime || '00:00',
                 endTime: endTime || '00:00',
                 category: category,
                 description: description,
                 recurring: recurring
             };

             events.push(event);
             saveEvents();
             
             // Clear form
             document.getElementById('journalPaneEventTitle').value = '';
             document.getElementById('journalPaneEventDate').value = dateToString(new Date());
             document.getElementById('journalPaneEventEndDate').value = '';
             document.getElementById('journalPaneEventDesc').value = '';
             document.getElementById('journalPaneEventStartTime').value = '';
             document.getElementById('journalPaneEventEndTime').value = '';
             document.getElementById('journalPaneEventRecurring').value = 'none';
             
             // Refresh calendar and timeline
             renderCalendar();
             renderTimeline();
             
             alert('Event added!');
         }

        function toggleTimelineView() {
            const timelineWrapper = document.querySelector('.timeline-wrapper');
            const calendarWrapper = document.querySelector('.calendar-wrapper');
            
            if (timelineWrapper.style.display === 'none' || timelineWrapper.style.display === '') {
                calendarWrapper.style.display = 'none';
                timelineWrapper.style.display = 'block !important';
                document.querySelector('[onclick="toggleTimelineView()"]').textContent = 'Show Calendar';
                renderTimeline();
            } else {
                calendarWrapper.style.display = 'block';
                timelineWrapper.style.display = 'none';
                document.querySelector('[onclick="toggleTimelineView()"]').textContent = 'Show Timeline';
            }
        }

        function previousDay() {
            plannerCurrentDate.setDate(plannerCurrentDate.getDate() - 1);
            renderPlannerToday();
            renderPlannerSchedule();
            updatePlannerJournalForDate();
        }

        function nextDay() {
            plannerCurrentDate.setDate(plannerCurrentDate.getDate() + 1);
            renderPlannerToday();
            renderPlannerSchedule();
            updatePlannerJournalForDate();
        }

        function updatePlannerJournalForDate() {
            const dateStr = dateToString(plannerCurrentDate);
            const dayEntries = journals.filter(j => j.date === dateStr);
            const container = document.getElementById('plannerDayJournalEntries');
            
            // Set the day title
            const dateDisplay = plannerCurrentDate.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('plannerDayTitle').textContent = ` ${dateDisplay}`;

            // Set the event date field
            document.getElementById('journalPaneEventDate').value = dateStr;

            if (dayEntries.length === 0) {
                container.innerHTML = '<div class="planner-empty">No entries for this day</div>';
                return;
            }

            let html = '';
            dayEntries.forEach(entry => {
                const preview = entry.text.substring(0, 50) + (entry.text.length > 50 ? '...' : '');
                
                html += `
                    <div style="background: rgba(99, 102, 241, 0.06); padding: 8px; border-radius: 6px; margin-bottom: 6px; cursor: pointer; font-size: 0.75rem;" onclick="viewJournalEntry('${entry.id}')">
                        <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 2px;">${entry.mood} Entry</div>
                        <div style="color: var(--text-secondary);">${preview}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderPlannerToday() {
            const dateStr = dateToString(plannerCurrentDate);
            const displayStr = plannerCurrentDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            document.getElementById('todayDateDisplay').textContent = displayStr;

            // Upcoming events
            const dayEvents = events.filter(e => {
                const eventStart = new Date(e.date);
                const eventEnd = new Date(e.endDate || e.date);
                const currentDay = new Date(dateStr);
                return currentDay >= eventStart && currentDay <= eventEnd;
            }).sort((a, b) => (a.startTime || a.time || '00:00').localeCompare(b.startTime || b.time || '00:00'));

            const eventsContainer = document.getElementById('todayUpcomingEvents');
            if (dayEvents.length === 0) {
                eventsContainer.innerHTML = '<div class="planner-empty">No events</div>';
            } else {
                eventsContainer.innerHTML = dayEvents.map(e => {
                    const startTime = e.startTime || e.time || '00:00';
                    const endTime = e.endTime || '00:00';
                    const timeDisplay = startTime !== '00:00' ? `${startTime}${endTime !== '00:00' ? ' - ' + endTime : ''}` : 'All day';
                    return `
                        <div class="planner-event-item" onclick="selectEvent('${e.id}')">
                            <div class="planner-event-time">${timeDisplay}</div>
                            <div class="planner-event-title">${e.title}</div>
                        </div>
                    `;
                }).join('');
            }

            // Today's todos (todos for this date or all todos)
            const todayTodosHtml = plannerTodos.map((todo, idx) => `
                <label class="planner-todo-item">
                    <input type="checkbox" class="planner-todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${idx})">
                    <span class="planner-todo-text">${todo.text}</span>
                </label>
            `).join('');
            document.getElementById('todayTodos').innerHTML = todayTodosHtml || '<div class="planner-empty">No todos</div>';
        }

        function renderPlannerSchedule() {
            const dateStr = dateToString(plannerCurrentDate);
            const displayStr = plannerCurrentDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            document.getElementById('scheduleDateDisplay').textContent = displayStr;

            const dayEvents = events.filter(e => {
                const eventStart = new Date(e.date);
                const eventEnd = new Date(e.endDate || e.date);
                const currentDay = new Date(dateStr);
                return currentDay >= eventStart && currentDay <= eventEnd;
            }).sort((a, b) => (a.startTime || a.time || '00:00').localeCompare(b.startTime || b.time || '00:00'));

            const eventsContainer = document.getElementById('scheduleDayEvents');
            if (dayEvents.length === 0) {
                eventsContainer.innerHTML = '<div class="planner-empty">No events scheduled</div>';
            } else {
                eventsContainer.innerHTML = dayEvents.map(e => {
                    const startTime = e.startTime || e.time || '00:00';
                    const endTime = e.endTime || '00:00';
                    const timeDisplay = startTime !== '00:00' ? `${startTime}${endTime !== '00:00' ? ' - ' + endTime : ''}` : 'All day';
                    return `
                        <div class="planner-event-item">
                            <div class="planner-event-time">${timeDisplay}</div>
                            <div class="planner-event-title">${e.title}</div>
                        </div>
                    `;
                }).join('');
            }
        }

        function renderPlannerTodos() {
            const todosHtml = plannerTodos.map((todo, idx) => `
                <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                    <label class="planner-todo-item" style="margin-bottom: 0;">
                        <input type="checkbox" class="planner-todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${idx})">
                        <span class="planner-todo-text">${todo.text}</span>
                    </label>
                    <button onclick="deleteTodo(${idx})" style="background: none; border: none; color: var(--danger); cursor: pointer; padding: 0; font-size: 0.75rem;"></button>
                </div>
            `).join('');
            document.getElementById('allTodos').innerHTML = todosHtml || '<div class="planner-empty">No todos yet</div>';
        }

        function addScheduleEvent() {
             const title = document.getElementById('scheduleEventTitle').value.trim();
             const dateStr = document.getElementById('scheduleEventDate').value || dateToString(plannerCurrentDate);
             const endDateStr = document.getElementById('scheduleEventEndDate').value;
             const startTime = document.getElementById('scheduleEventStartTime').value;
             const endTime = document.getElementById('scheduleEventEndTime').value;
             const recurring = document.getElementById('scheduleEventRecurring').value;

             if (!title) {
                 alert('Please enter an event name');
                 return;
             }

             if (endDateStr && new Date(endDateStr) < new Date(dateStr)) {
                 alert('End date must be after or equal to start date');
                 return;
             }

             const event = {
                 id: Date.now().toString(),
                 title,
                 date: dateStr,
                 endDate: endDateStr || dateStr,
                 startTime: startTime || '00:00',
                 endTime: endTime || '00:00',
                 category: 'personal',
                 description: '',
                 recurring: recurring
             };

             events.push(event);
             saveEvents();
             document.getElementById('scheduleEventTitle').value = '';
             document.getElementById('scheduleEventDate').value = dateToString(plannerCurrentDate);
             document.getElementById('scheduleEventEndDate').value = '';
             document.getElementById('scheduleEventStartTime').value = '';
             document.getElementById('scheduleEventEndTime').value = '';
             document.getElementById('scheduleEventRecurring').value = 'none';
             renderPlannerSchedule();
             renderCalendar();
         }

        function addTodo() {
            const text = document.getElementById('todoInput').value.trim();
            if (!text) {
                alert('Please enter a todo');
                return;
            }

            plannerTodos.push({
                text,
                completed: false,
                createdAt: new Date().toISOString()
            });

            saveTodos();
            document.getElementById('todoInput').value = '';
            renderPlannerTodos();
        }

        function toggleTodo(idx) {
            plannerTodos[idx].completed = !plannerTodos[idx].completed;
            saveTodos();
            renderPlannerTodos();
        }

        function deleteTodo(idx) {
            plannerTodos.splice(idx, 1);
            saveTodos();
            renderPlannerTodos();
        }

        function saveTodos() {
            localStorage.setItem('joureviTodos', JSON.stringify(plannerTodos));
        }

        function selectEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                const modal = document.getElementById('eventModal');
                document.getElementById('modalTitle').textContent = event.title;
                document.getElementById('modalBody').innerHTML = `
                    <p><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
                    <p><strong>Time:</strong> ${event.time !== '00:00' ? event.time : 'All day'}</p>
                    <p><strong>Category:</strong> ${event.category}</p>
                    ${event.description ? `<p><strong>Description:</strong> ${event.description}</p>` : ''}
                `;
                selectedEventId = eventId;
                modal.classList.add('active');
            }
        }

        // Management Section Data
        let familyMembers = JSON.parse(localStorage.getItem('joureviFamily')) || [];
        let teams = JSON.parse(localStorage.getItem('joureviTeams')) || [];
        let projects = JSON.parse(localStorage.getItem('joureviProjects')) || [];

        function switchMgmtView(view) {
            document.querySelectorAll('.mgmt-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.mgmt-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(view + 'Pane').classList.add('active');
            document.querySelector(`[onclick="switchMgmtView('${view}')"]`).classList.add('active');

            if (view === 'journal') {
                renderJournalStats();
            } else if (view === 'events') {
                renderUpcomingEventsList();
            } else if (view === 'family') {
                renderFamilyList();
            }
        }

        function renderJournalStats() {
            const totalEntries = journals.length;
            const thisMonth = journals.filter(j => {
                const entryDate = new Date(j.date);
                const now = new Date();
                return entryDate.getMonth() === now.getMonth() && entryDate.getFullYear() === now.getFullYear();
            }).length;

            // Calculate streak
            let streak = 0;
            const today = new Date();
            let checkDate = new Date(today);
            const sortedJournals = journals.sort((a, b) => new Date(b.date) - new Date(a.date));
            const journalDates = sortedJournals.map(j => j.date);

            for (let i = 0; i < 365; i++) {
                const dateStr = dateToString(checkDate);
                if (journalDates.includes(dateStr)) {
                    streak++;
                } else {
                    break;
                }
                checkDate.setDate(checkDate.getDate() - 1);
            }

            document.getElementById('totalEntries').textContent = totalEntries;
            document.getElementById('thisMonth').textContent = thisMonth;
            document.getElementById('currentStreak').textContent = streak;

            const recentList = document.getElementById('journalRecentList');
            const recent = sortedJournals.slice(0, 3);
            if (recent.length === 0) {
                recentList.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">No entries yet.</p>';
                return;
            }

            let html = '<div style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">Recent Entries</div>';
            recent.forEach(entry => {
                const entryDate = new Date(entry.date);
                const dateStr = entryDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const preview = entry.text.substring(0, 40) + '...';
                html += `<div style="background: rgba(99, 102, 241, 0.06); padding: 8px; border-radius: 6px; margin-bottom: 6px; cursor: pointer; font-size: 0.8rem;" onclick="viewJournalEntry('${entry.id}')">
                    <div style="font-weight: 600; color: var(--text-primary);">${entry.mood} ${dateStr}</div>
                    <div style="color: var(--text-secondary); margin-top: 2px;">${preview}</div>
                </div>`;
            });
            recentList.innerHTML = html;
        }

        function renderUpcomingEventsList() {
            const now = new Date();
            const upcoming = events.filter(e => new Date(e.date) >= now).sort((a, b) => new Date(a.date) - new Date(b.date)).slice(0, 5);
            const container = document.getElementById('upcomingEventsList');

            if (upcoming.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">No upcoming events.</p>';
                return;
            }

            let html = '';
            upcoming.forEach(event => {
                const eventDate = new Date(event.date);
                const dateStr = eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const startTime = event.startTime || event.time || '00:00';
                const endTime = event.endTime || '00:00';
                const timeDisplay = startTime !== '00:00' ? `at ${startTime}${endTime !== '00:00' ? ' - ' + endTime : ''}` : '(All day)';
                html += `<div class="event-item">
                    <div class="event-item-title">${event.title}</div>
                    <div class="event-item-date">${dateStr} ${timeDisplay}</div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function renderFamilyList() {
            const container = document.getElementById('familyList');
            if (familyMembers.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">No family members added yet.</p>';
                return;
            }

            let html = '';
            familyMembers.forEach((member, idx) => {
                html += `<div class="family-member">
                    <span>${member}</span>
                    <button onclick="removeFamilyMember(${idx})" style="background: none; border: none; color: var(--danger); cursor: pointer;"></button>
                </div>`;
            });
            container.innerHTML = html;
        }

        function addFamilyMember() {
            const input = document.getElementById('familyInput');
            const name = input.value.trim();
            if (!name) {
                alert('Please enter a family member name');
                return;
            }
            familyMembers.push(name);
            localStorage.setItem('joureviFamily', JSON.stringify(familyMembers));
            input.value = '';
            renderFamilyList();
        }

        function removeFamilyMember(idx) {
            familyMembers.splice(idx, 1);
            localStorage.setItem('joureviFamily', JSON.stringify(familyMembers));
            renderFamilyList();
        }

        function addTeam() {
            const input = document.getElementById('teamInput');
            const name = input.value.trim();
            if (!name) {
                alert('Please enter a team name');
                return;
            }
            teams.push({ id: Date.now().toString(), name });
            localStorage.setItem('joureviTeams', JSON.stringify(teams));
            input.value = '';
            renderTeams();
        }

        function removeTeam(idx) {
            teams.splice(idx, 1);
            localStorage.setItem('joureviTeams', JSON.stringify(teams));
            renderTeams();
        }

        function renderTeams() {
            const container = document.getElementById('teamsList');
            if (teams.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem; grid-column: 1/-1;">No teams yet. Create your first team!</p>';
                return;
            }

            let html = '';
            teams.forEach((team, idx) => {
                html += `<div class="team-card">
                    <span>${team.name}</span>
                    <button onclick="removeTeam(${idx})"></button>
                </div>`;
            });
            container.innerHTML = html;
        }

        function addProject() {
            const input = document.getElementById('projectInput');
            const name = input.value.trim();
            if (!name) {
                alert('Please enter a project name');
                return;
            }
            projects.push({ id: Date.now().toString(), name, progress: 0 });
            localStorage.setItem('joureviProjects', JSON.stringify(projects));
            input.value = '';
            renderProjects();
        }

        function removeProject(idx) {
            projects.splice(idx, 1);
            localStorage.setItem('joureviProjects', JSON.stringify(projects));
            renderProjects();
        }

        function renderProjects() {
            const container = document.getElementById('projectsList');
            if (projects.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">No projects in progress.</p>';
                return;
            }

            let html = '';
            projects.forEach((project, idx) => {
                html += `<div class="project-card">
                    <span class="project-name">${project.name}</span>
                    <button onclick="removeProject(${idx})"></button>
                </div>`;
            });
            container.innerHTML = html;
        }

        // Initialize
        initializeCalendar();
        renderTeams();
        renderProjects();
        renderFamilyList();
    </script>
</body>

</html>
